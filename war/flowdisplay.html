<!--
  Copyright (c) 2006-2013, JGraph Ltd

  File I/O example for mxGraph. This example demonstrates reading an
  XML file, writing a custom parser, applying an automatic layout and
  defining a 2-way edge.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Network Project Status Tracker</title>

    <!-- Bootstrap core CSS     -->
    <link href="assets/dashboard-bootstrap/assets/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Animation library for notifications   -->
    <link href="assets/dashboard-bootstrap/assets/css/animate.min.css" rel="stylesheet"/>
    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/dashboard-bootstrap/assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>
    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="assets/dashboard-bootstrap/assets/css/pe-icon-7-stroke.css" rel="stylesheet" />

    <!-- Sets the basepath for the mxGraph library if not in same directory -->
    <script type="text/javascript">
        mxBasePath = '../src';
    </script>

    <!-- Loads and initializes the library -->
    <!--<script type="text/javascript" src="./templates/charts/coc.xml"></script>-->
    <script type="text/javascript" src="../etc/mxgraph/mxClient.js"></script>

    <!-- Example code -->
    <script type="text/javascript">
        "use strict";

        //Create parsers for style conversion
        var styleStringToObject = function (styleString) {
            var style = {},
                attributes = styleString.split(';');

            for (var i = 0; i < attributes.length; i++) {
                var entry = attributes[i].split('=');
                style[entry.splice(0,1)[0]] = entry.join(':');
            }
            return style;
        };

        var objectToStyleString = function (object) {
            var string = "";
            for (var key in object) {
                string += key + "=" + object[key] + ";";
            }
            return string;
        };

        var activateCell = function (cell) {
            var style = cell.getStyle();
            var object = styleStringToObject(style);

            //Change background to cyan
            object.fillColor = "#33a7ac";

            var style2 = objectToStyleString(object);
            cell.setStyle(style2);
            cell.setAttribute("current","1");
        };

        var deactivateCell = function (cell) {
            var style = cell.getStyle();
            var object = styleStringToObject(style);

            //Change background to white
            object.fillColor = "#ffffff";

            var style2 = objectToStyleString(object);
            cell.setStyle(style2);
            cell.setAttribute("current","0");
        };

        var isActiveCell = function (cell) {
            var style = cell.getStyle();
            var object = styleStringToObject(style);

            return object.fillColor === "#33a7ac";
        };


        // Program starts here. Creates a sample graph in the
        // DOM node with the specified ID. This function is invoked
        // from the onLoad event handler of the document (see below).
        function main(container)
        {
            // Checks if browser is supported
            if (!mxClient.isBrowserSupported())
            {
                // Displays an error message if the browser is
                // not supported.
                mxUtils.error('Browser is not supported!', 200, false);
            }
            else
            {
                // Creates the graph inside the given container
                mxGraph.prototype.ordered = false;
                var graph = new mxGraph(container);

                graph.setEnabled(false);
                graph.setPanning(true);
                graph.setTooltips(true);
                graph.panningHandler.useLeftButtonForPanning = true;


                // Adds a highlight on the cell under the mousepointer
                new mxCellTracker(graph);

                // Changes the default vertex style in-place
                var style = graph.getStylesheet().getDefaultVertexStyle();
                style[mxConstants.STYLE_SHAPE] = mxConstants.SHAPE_SWIMLANE;

                graph.isHtmlLabel = function(cell)
                {
                    return true;
                };

                // Larger grid size yields cleaner layout result
                graph.gridSize = 20;

//                document.body.appendChild(mxUtils.button('Edit',function(evt)
//                {
//                    window.location = "./index.html";
//                }));

                // Load cells and layouts the graph
                graph.getModel().beginUpdate();
                try
                {
                    // Loads the custom file format (TXT file)
//					parse(graph, 'fileio.txt');

                    // Loads the mxGraph file format (XML file)
                    read(graph, './test.xml');


                }
                finally
                {

                    var allCells = graph.getModel().cells;
                    console.log(allCells);
                    for (var key in allCells) {

                        var cell = allCells[key];
                        if (cell.getAttribute("current") === "1") {
                            console.log(cell.getStyle());
                            activateCell(cell);

                        } else if (cell.isVertex()) {
                            deactivateCell(cell);
                        }
                    }
                    // Updates the display
                    graph.getModel().endUpdate();

                }

                graph.getSelectionModel().addListener(mxEvent.CHANGE, function(sender, evt)
                {
                    mxUtils.alert("something changed");
                });


                graph.dblClick = function(evt, cell)
                {
                    var mxe = new mxEventObject(mxEvent.DOUBLE_CLICK, 'event', evt, 'cell', cell);
                    this.fireEvent(mxe);

                    //If Vertex, only process clicks on the current node
                    if (cell.isVertex()) {
                        if (isActiveCell(cell.getAttribute("current") === "1")) {
                            mxUtils.alert('Cell '+(cell.customId || cell.getId()) + " is active");
                        } else {
                            mxUtils.alert('Cell '+(cell.customId || cell.getId()) + " is passive");
                        }
                    } else if (cell.isEdge()) {

                        if (isActiveCell(cell.source)) {
                            console.log("before target = ");
                            console.log(cell.target);
                            console.log("before source = ");
                            console.log(cell.source);
                            graph.getModel().beginUpdate();

                            try {
                                activateCell(cell.target);
                                deactivateCell(cell.source);

                                //Update View
                                graph.getView().clear(cell.target, false, false);
                                graph.getView().clear(cell.source, false, false);
                                graph.getView().validate();
                            }
                            finally {
                                //Update Attributes
                                graph.getModel().endUpdate();
                            }
                            console.log("after target = ");
                            console.log(cell.target);
                            console.log("after source = ");
                            console.log(cell.source);
                        }
                    }


//                    mxUtils.alert('Show properties for cell '+(cell.customId || cell.getId())+ cell.isVertex() + cell.getAttribute("current") + cell.source + cell.target);
//                    if (this.isEnabled() &&
//                        !mxEvent.isConsumed(evt) &&
//                        !mxe.isConsumed() &&
//                        cell != null)
//                    {
//                        mxUtils.alert('Show properties for cell '+(cell.customId || cell.getId()));
//                    }
                };

                if (mxClient.IS_QUIRKS)
                {
                    document.body.style.overflow = 'hidden';
                    new mxDivResizer(container);
                }
            }
        };

        // Custom parser for simple file format
        function parse(graph, filename)
        {
            var model = graph.getModel();

            // Gets the default parent for inserting new cells. This
            // is normally the first child of the root (ie. layer 0).
            var parent = graph.getDefaultParent();

            var req = mxUtils.load(filename);
            var text = req.getText();

            var lines = text.split('\n');

            // Creates the lookup table for the vertices
            var vertices = [];

        };

        // Parses the mxGraph XML file format
        function read(graph, filename)
        {
            var req = mxUtils.load(filename);
            var root = req.getDocumentElement();
            var dec = new mxCodec(root.ownerDocument);

            dec.decode(root, graph.getModel());
        };
    </script>
</head>

    <!-- Page passes the container for the graph to the program -->
    <body onload="main(document.getElementById('graphContainer'))" style="margin:20px;">
        <div class="container">
            <div class="row">
                <nav class="navbar navbar-default navbar-fixed">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="#">Network Project Status Dashboard</a>
                        </div>

                        <div class="collapse navbar-collapse">

                            <ul class="nav navbar-nav navbar-left">
                                <li>
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-dashboard"></i>
                                        <p class="hidden-lg hidden-md">Network Project Status Dashboard</p>
                                    </a>
                                </li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-globe"></i>
                                        <b class="caret hidden-sm hidden-xs"></b>
                                        <span class="notification hidden-sm hidden-xs">5</span>
                                        <p class="hidden-lg hidden-md">
                                            5 Notifications
                                            <b class="caret"></b>
                                        </p>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">2 build tasks pending assignment</a></li>
                                        <li><a href="#">1 pending Q&A</a></li>
                                        <li><a href="#">3 deadlines approaching</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="">
                                        <i class="fa fa-search"></i>
                                        <p class="hidden-lg hidden-md">Search</p>
                                    </a>
                                </li>
                            </ul>

                            <ul class="nav navbar-nav navbar-right">
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        <p>
                                            Menu
                                            <b class="caret"></b>
                                        </p>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">ITSM</a></li>
                                        <li><a href="#">PRIME</a></li>
                                        <li><a href="#">WRM</a></li>
                                        <li><a href="#">My Compute</a></li>
                                        <li><a href="#">SharePoint</a></li>
                                        <li class="divider"></li>
                                        <li><a href="#">Help</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="">
                                        <p>My Account</p>
                                    </a>
                                </li>


                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                                        John Doe <span class="caret"></span>
                                    </a>

                                    <ul class="dropdown-menu" role="menu">
                                        <li>
                                            <a href="/logout
                                                            onclick="event.preventDefault();
                                               document.getElementById('logout-form').submit();">
                                            Logout
                                            </a>

                                            <form id="logout-form" action="/logout" method="POST" style="display: none;">
                                            </form>
                                        </li>
                                    </ul>
                                </li>
                                <li class="separator hidden-lg hidden-md"></li>



                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="row" style="padding-top: 50px">
                <!-- Creates a container for the graph with a grid wallpaper. Make sure to define the position
                    and overflow attributes! See comments on the adding of the size-listener on line 54 ff!  -->
                <div id="graphContainer"
                     style="overflow:auto;border-top:gray 1px solid;">
                </div>
            </div>
        </div>
    </body>

<!--   Core JS Files   -->
<script src="assets/dashboard-bootstrap/assets/js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="assets/dashboard-bootstrap/assets/js/bootstrap.min.js" type="text/javascript"></script>

</html>
